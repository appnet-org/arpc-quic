// Code generated by protoc-gen-arpc. DO NOT EDIT.
package kv

import (
	"context"

	"github.com/appnet-org/arpc/pkg/rpc"
	"github.com/appnet-org/arpc/pkg/rpc/element"
)

// Service IDs
const (
	ServiceID_KVService = 1
)

// Service name <-> ID mappings
var serviceNameToID = map[string]uint32{
	"KVService": ServiceID_KVService,
}

var serviceIDToName = map[uint32]string{
	ServiceID_KVService: "KVService",
}

// Method IDs for KVService
const (
	KVService_MethodID_Get = 1
	KVService_MethodID_Set = 2
)

// Method name <-> ID mappings for KVService
var KVService_methodNameToID = map[string]uint32{
	"Get": KVService_MethodID_Get,
	"Set": KVService_MethodID_Set,
}

var KVService_methodIDToName = map[uint32]string{
	KVService_MethodID_Get: "Get",
	KVService_MethodID_Set: "Set",
}

// KVServiceClient is the client API for KVService service.
type KVServiceClient interface {
	Get(ctx context.Context, req *GetRequest) (*GetResponse, error)
	Set(ctx context.Context, req *SetRequest) (*SetResponse, error)
}

type arpcKVServiceClient struct {
	client *rpc.Client
}

func NewKVServiceClient(client *rpc.Client) KVServiceClient {
	// Create and register service registry
	registry := rpc.NewServiceRegistry()
	registry.RegisterService("KVService", ServiceID_KVService, KVService_methodNameToID)
	client.SetServiceRegistry(registry)
	return &arpcKVServiceClient{client: client}
}

func (c *arpcKVServiceClient) Get(ctx context.Context, req *GetRequest) (*GetResponse, error) {
	resp := new(GetResponse)
	if err := c.client.Call(ctx, "KVService", "Get", req, resp); err != nil {
		return nil, err
	}
	return resp, nil
}

func (c *arpcKVServiceClient) Set(ctx context.Context, req *SetRequest) (*SetResponse, error) {
	resp := new(SetResponse)
	if err := c.client.Call(ctx, "KVService", "Set", req, resp); err != nil {
		return nil, err
	}
	return resp, nil
}

type KVServiceServer interface {
	Get(ctx context.Context, req *GetRequest) (*GetResponse, context.Context, error)
	Set(ctx context.Context, req *SetRequest) (*SetResponse, context.Context, error)
}

func RegisterKVServiceServer(s *rpc.Server, srv KVServiceServer) {
	s.RegisterService(&rpc.ServiceDesc{
		ServiceName: "KVService",
		ServiceID:   ServiceID_KVService,
		ServiceImpl: srv,
		MethodsByID: map[uint32]*rpc.MethodDesc{
			KVService_MethodID_Get: {
				MethodName: "Get",
				MethodID:   KVService_MethodID_Get,
				Handler:    _KVService_Get_Handler,
			},
			KVService_MethodID_Set: {
				MethodName: "Set",
				MethodID:   KVService_MethodID_Set,
				Handler:    _KVService_Set_Handler,
			},
		},
	}, srv)
}

func _KVService_Get_Handler(srv any, ctx context.Context, dec func(any) error, req *element.RPCRequest, chain *element.RPCElementChain) (*element.RPCResponse, context.Context, error) {
	req.Payload = new(GetRequest)
	if err := dec(req.Payload); err != nil {
		return nil, ctx, err
	}
	req, ctx, err := chain.ProcessRequest(ctx, req)
	if err != nil {
		return nil, ctx, err
	}
	result, ctx, err := srv.(KVServiceServer).Get(ctx, req.Payload.(*GetRequest))
	if err != nil {
		return nil, ctx, err
	}
	resp := &element.RPCResponse{
		ID:     req.ID,
		Result: result,
	}
	resp, ctx, err = chain.ProcessResponse(ctx, resp)
	if err != nil {
		return nil, ctx, err
	}
	return resp, ctx, err
}

func _KVService_Set_Handler(srv any, ctx context.Context, dec func(any) error, req *element.RPCRequest, chain *element.RPCElementChain) (*element.RPCResponse, context.Context, error) {
	req.Payload = new(SetRequest)
	if err := dec(req.Payload); err != nil {
		return nil, ctx, err
	}
	req, ctx, err := chain.ProcessRequest(ctx, req)
	if err != nil {
		return nil, ctx, err
	}
	result, ctx, err := srv.(KVServiceServer).Set(ctx, req.Payload.(*SetRequest))
	if err != nil {
		return nil, ctx, err
	}
	resp := &element.RPCResponse{
		ID:     req.ID,
		Result: result,
	}
	resp, ctx, err = chain.ProcessResponse(ctx, resp)
	if err != nil {
		return nil, ctx, err
	}
	return resp, ctx, err
}
